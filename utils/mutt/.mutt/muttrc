# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# drag0n's personal .muttrc
#
# The format of this file is one command per line.  Everything after a pound
# sign (#) is a comment, unless a backward slash (\) precedes it.  Note: In
# folder-hook and send-hook you need to account for two levels of dequoting
# (see manual).
#

# How to create .gmail-password.gpg:
#  echo "password" > ~/.gmail-password.gpg
#  gpg --full-gen-key
#  gpg --recipient $USER --encrypt ~/.gmail-password
source "gpg -dq $HOME/.gmail-password.gpg |"

# config commands local to this site
source ~/.muttrc-private

set abort_unmodified=yes    # automatically abort replies if I don't
                            # change the message
set alias_file=~/.mail_aliases  # where I keep my aliases
#set allow_8bit         # never do Q-P encoding on legal 8-bit chars
# Highlight the whole line instead of ->
unset arrow_cursor
# Show Bcc: field
set askbcc
# Show Cc: field
set askcc
# how to attribute replies
set attribution="On %d, %n wrote:"
set autoedit            # go to the editor right away when composing
#set auto_tag           # always operate on tagged messages
# character set for your terminal
set charset = UTF8
set noconfirmappend     # don't ask me if i want to append to mailboxes
set confirmcreate       # prompt when creating new files
set copy=yes            # always save a copy of outgoing messages
set delete=yes          # purge deleted messages without asking
set edit_headers        # let me edit the message header when composing
# editor to use when composing messages
set editor="vim -c 'set syntax=mail ft=mail enc=utf-8'"
#set bounce=yes         # don't ask about bouncing messages, just do it
#set fast_reply         # skip initial prompts when replying
#set fcc_attach         # keep attachments in copies of sent messages?
#set force_name         # fcc by recipient, create if mailbox doesn't exist
#set forward_decode     # weed and MIME decode forwaded messages
# subject to use when forwarding messages
set forward_format="Fwd: [%a: %s]"
#set forward_quote      # quote the header and body of forward msgs
#set index_format="%4C %Z %{%m/%d} [%2N] %-15.15F (%4c) %s"
set index_format="%4C %Z %{%d-%m-%y} %-15.15F (%4c) %s" # format of the index
#set hdrs           # include `my_hdr' lines in outgoing messages
#set header         # include message header when replying
set help            # show the help lines
#set history=20         # number of lines of history to remember
#set hostname="mutt.org"    # my DNS domain
# always include messages when replying
set include
# how to quote replied text
set indent_string="> "
set mailcap_path="~/.mailcap"
set nomark_old          # i don't care about whether a message is old
set mail_check=10       # how often to poll for new mail
set mbox=+mbox          # where to store read messages
set menu_scroll         # no implicit next-page/prev-page
# remove my address when replying
set metoo
set mime_forward        # use message/rfc822 type to forward messages
set move = no             # ask about moving messages, just do it
#set pager=less         # some people prefer an external pager
#set pager_context=3        # no. of lines of context to give when scrolling
#set pager_format="-%S- %-20.20f %s"    # format of the pager status bar
set pager_index_lines=6     # how many index lines to show in the pager
# don't move to the next message on next-page
set pager_stop
# No plus signs
unset markers
#set pgp_strict_enc     # use Q-P encoding when needed for PGP
#set post_indent_string='---end quoted text---'
set print=ask-yes       # ask me if I really want to print messages
set print_command=/bin/false    # how to print things (I like to save trees)
set noprompt_after  # ask me for a command after the external pager exits
set quote_regexp="^ *[a-zA-Z]*[>:#}]"  # how to catch quoted text
set read_inc=25         # show progress when reading a mailbox
#set recall         # prompt to recall postponed messages
# default location to save outgoing mail
set record = '=Sent'
set postponed = '=Drafts'
set reply_to            # always use reply-to if present
# how to identify replies in the subject:
set reply_regexp="^([Rr][Ee]:[ \t]*)+"
#set resolve        # move to the next message when an action is performed
#set reverse_alias      # attempt to look up my names for people
set reverse_name        # use my address as it appears in the message
                        # i am replying to
set nosave_empty        # remove files when no messages are left
#set save_name          # save outgoing messages by recipient, if the
#set sendmail="/usr/lib/sendmail -oi -oem"  # how to deliver mail
# program to use for shell escapes
set shell="/bin/bash"
# file which contains my signature
set signature="~/.signature"
# dashes before signature
set sig_dashes

# sort by threads
set sort = threads
# date of the last message in thread
set sort_aux = last-date-received
# how to sort files in the dir browser
set sort_browser = date
# Thread based on subject, not on reply_regexp
unset sort_re
#set status_format="-%r-Mutt: %f [Msgs:%?M?%M/?%m%?n? New:%n?%?d? Del:%d?%?F? Flag:%F?%?t? Tag:%t?%?p? Post:%p?%?b? Inc:%b?  %l]---(%s)-%>-(%P)---"
#set status_on_top      # some people prefer the status bar on top
# threads by subject
set strict_threads = no
# virtual lines to pad blank lines in the pager
set tilde
#set timeout=0          # timeout for prompt in the index menu
#set tmpdir=~/tmp       # where to store temp files
#set to_chars=" +TCF"
#set use_8bitmime       # enable the -B8BITMIME sendmail flag
set nouse_domain        # don't qualify local addresses with $domain
set use_from = yes      # always generate the `From:' header field
set envelope_from = yes
# pager shows parts having a mailcap viewer
set implicit_autoview = yes
set pgp_verify_sig=no       # don't automatically verify message signatures
# editor invoked by ~v in the builtin editor
set visual=vim
#set nowait_key         # prompt when a pipe returns normal status
set write_inc=25        # show progress while writing mailboxes
set send_charset="utf-8"
# IMAP connection settings
set mail_check = 60
set imap_keepalive = 900
# Sidebar settings
set sidebar_visible = yes
set sidebar_width = 24
set sidebar_folder_indent = yes
set sidebar_short_path = yes
# make the progress updates not that expensive, this will update the bar every 300ms
set time_inc = 300
# Allow Mutt to open a new IMAP connection automatically.
unset imap_passive
# Query emails from abook
set query_command= "abook --mutt-query '%s'"
# Disable beeps
unset beep
# First, search for plain text in mail, then - search for html
alternative_order text/plain text/html

set ssl_starttls=yes
set ssl_force_tls=yes

set header_cache = "~/.mutt/cache/headers"
set message_cachedir = "~/.mutt/cache/bodies"
set certificate_file = "~/.mutt/certificates"




# only enable the following IFF you have sendmail 8.8.x or you will not
# be able to send mail!!!
#set dsn_notify='failure,delay' # when to return an error message
#set dsn_return=hdrs        # what to return in the error message

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# this means "ignore all lines by default"
ignore *
# I do want to see these fields, though!
unignore    from: subject to cc mail-followup-to \
        date x-mailer x-url
unhdr_order *
hdr_order date from subject to cc

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Color definitions
#

# normal (not quoted) text
color normal black default
# default color of the message header in the pager
color hdrdefault blue default
# text matching $quote_regexp in the body of the message
color quoted green white
# any text beneath the signature line
color signature green white
# arrow or bar used to indicate the current item in a menu
color indicator white black
# error messages printed by mutt
color error brightred default
# mode lines used to display info about the mailbox or message
color status white blue
# thread color in index menu
color tree magenta default
# the "~" used to pad blank lines in the pager
color tilde blue default
# Informational messages
color message blue default
# the "+" markers at the beginning of wrapped lines in the pager
color markers blue white
# any attachments present
color attachment magenta default
# highlighting of words in the pager
color search black green
# match regexp in the message header
color header red default ^(From|Subject):
# point out URLs
color body magenta default "(ftp|http|https)://[^ ]+"
# e-mail addresses
color body magenta default "[-a-z_0-9.]+@[-a-z_0-9.]+"
# Highlighting underlined patters in the body of messages
color underline green white

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Key bindings
#
#   maps:
#       alias       alias menu
#       attach      attachment menu
#       browser     directory browser
#       compose     compose menu
#       index       message index
#       pgp     pgp menu
#       postpone    postponed message recall menu
#       generic     generic keymap for all of the above
#       editor      line editor
#       pager       text viewer
#

bind generic "\e<" first-entry  # emacs-like bindings for moving to top/bottom
bind generic \e> last-entry
bind generic { top-page
bind generic } bottom-page
bind generic \177 last-entry

macro index S "<save-message>+spam<Enter>"
macro pager S "<save-message>+spam<Enter>"

#macro index \# "<search>bug<Enter>"    # search for bugs
#macro index "\""   "<enter-command> set realname=\"real hairy macro\" ?realname<Enter>" # and a comment to boot!
#macro index f1 "<enter-command>woohoo!"

bind pager G bottom # just like vi and less
bind pager <up> previous-line
bind pager <down> next-line
#macro   pager   \Ck     "<pipe-message> pgp -kaf<Enter>"   # a comment is valid here
#macro pager X "<pipe-message> morepgp<Enter>"  # pipe PGP message to a script

#bind editor \cy eol    # make ^Y jump to the end of the line

bind index G imap-fetch-mail
bind index,pager J sidebar-next
bind index,pager K sidebar-prev
bind index,pager O sidebar-open
macro attach 'V' "<pipe-entry>cat >~/.mutt/mail.html && /usr/bin/firefox-bin ~/.mutt/mail.html && sleep 5 && rm ~/.mutt/mail.html<enter>"
macro index,pager  a "<pipe-message>abook --add-email-quiet<return>" "Add this sender to Abook"
bind editor        <Tab> complete-query
macro index .f "T~f .*@habr.com<enter><tag-prefix-cond><save-message>=habr<enter><end-cond>"


# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Specify default filename when saving messages
#
#   save-hook [!]<pattern> <mailbox>
#
# <mailbox> is provided as default when saving messages from <pattern>

#save-hook mutt- =mutt-mail
#save-hook aol\\.com$ +spam
#save-hook ^judge +diplomacy

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Multiple spool mailboxes
#
#   mbox-hook [!]<pattern> <mbox-mailbox>
#
# Read mail in <pattern> is moved to <mbox-mailbox> when <pattern> is
# closed.

#mbox-hook =mutt-users.in =mutt-users
#mbox-hook +TEST +inbox

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Change settings based upon message recipient
#
#   send-hook [!]<pattern> <command>
#
# <command> is executed when sending mail to an address matching <pattern>

#send-hook mutt- 'set signature=~/.sigmutt; my_hdr From: Mutt User <user@example.com>'

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Specify where to save composed messages
#
#   fcc-hook [!]<pattern> <mailbox>
#
# <pattern> is recipient(s), <mailbox> is where to save a copy

#fcc-hook joe +joe
#fcc-hook bob +bob

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Change settings based on mailbox
#
#   folder-hook [!]<pattern> <command>
#
# <command> is executed when opening a mailbox matching <pattern>

#folder-hook .      'set sort=date-sent'
#folder-hook mutt   'set index_format="%4C %Z %02m/%02N %-20.20F (%4l) %s"'
#folder-hook =mutt  my_hdr Revolution: \#9 # real comment

#folder-hook .      'set reply_regexp="^re:[ \t]*"'

# this mailing list prepends "[WM]" to all non reply subjects, so set
# $reply_regexp to ignore it
# Warning: May break threads for other people.
#folder-hook +wmaker    'set reply_regexp="^(re:[ \t]*)?\[WM\][ \t]*"'

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Aliases
#
#   alias <name> <address> [ , <address> ... ]

#alias exam "\# to annoy michael" <user@host>
#alias me Michael Elkins <me@mutt.org> # me!
#alias mutt-dev Mutt Development List <mutt-dev@mutt.org> # power users
#alias mutt-users Mutt User List <mutt-users@mutt.org>
#alias mutt-announce Mutt Announcement List <mutt-announce@mutt.org>

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Mailboxes to watch for new mail
#
#   mailboxes <path1> [ <path2> ... ]
#

mailboxes INBOX \
              habr

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Specify the order of the headers to appear when displaying a message
#
#   hdr_order <hdr1> [ <hdr2> ... ]
#


# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Identify mailing lists I subscribe to
#
#   lists <list-name> [ <list-name> ... ]

#lists ^mutt-dev@mutt\\.org$ ^mutt-users@mutt\\.org$

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Automatically use entries from ~/.mailcap to view these MIME types
#
#   auto_view <type> [ <type> ... ]

auto_view application/x-gunzip
auto_view application/x-gzip
auto_view text/html

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#
# Scoring
#
#   score <pattern> <value>
#
# 9999 and -9999 are special values which cause processing of hooks to stop
# at that entry.  If you prefix the score with an equal sign (=), the score
# is assigned to the message and processing stops.

#score '~f ^me@cs\.hmc\.edu$' 1000
#score '~t mutt | ~c mutt' =500
#score '~f aol\.com$' -9999

# EOF
